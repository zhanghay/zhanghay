<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/608189 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="5196"/>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><div style="line-height: 160%; box-sizing: content-box;"><ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;"><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">对话Demo
</a><ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;"><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">环境准备
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">模型下载
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">代码下载
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">终端对话
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">web对话
</a></li></ul></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">Lagent的Demo
</a><ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;"><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">环境准备
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">模型下载
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">代码下载
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">demo
</a></li></ul></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">浦语·灵笔图文理解创作 Demo
</a><ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;"><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">环境准备
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">模型下载
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">代码下载
</a></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">Demo运行
</a></li></ul></li><li style="line-height: 160%; box-sizing: content-box; position: relative;"><a style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">作业
</a></li></ul></div><h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">对话Demo</h2>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">环境准备</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 <a href="https://studio.intern-ai.org.cn/" style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">InternStudio</a> 平台中选择 A100(1/4) 的配置，如下图所示镜像选择 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Cuda11.7-conda</code></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">进入 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">conda</code> 环境之后，使用以下命令从本地克隆一个已有的 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">pytorch 2.0.1</code> 的环境</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">- bash
- bash /root/share/install_conda_env_internlm_base.sh internlm-demo 
- conda activate internlm-demo

</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">并在环境中安装运行 demo 所需要的依赖。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">python -m pip install --upgrade pip
pip install modelscope==1.9.5
pip install transformers==4.35.2
pip install streamlit==1.24.0
pip install sentencepiece==0.1.99
pip install accelerate==0.24.1
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">模型下载</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">新建 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">download.py</code> 文件并在其中输入以下内容，粘贴代码后记得保存文件，如下图所示。并运行 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">python /root/model/download.py</code> 执行下载，模型大小为 14 GB，下载模型大概需要 10~20 分钟</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> torch
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> modelscope <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> snapshot_download, AutoModel, AutoTokenizer
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> os
model_dir = snapshot_download(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'Shanghai_AI_Laboratory/internlm-chat-7b'</span>, cache_dir=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'/root/model'</span>, revision=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'v1.0.3'</span>)
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">代码下载</h3>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">cd /root/code
git clone https://gitee.com/internlm/InternLM.git
cd InternLM
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">代码更改</strong></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">将 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">/root/code/InternLM/web_demo.py</code> 中 29 行和 33 行的模型更换为本地的 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">/root/model/Shanghai_AI_Laboratory/internlm-chat-7b</code>。</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">终端对话</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">/root/code/InternLM</code> 目录下新建一个 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">cli_demo.py</code> 文件，将以下代码填入其中：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> torch
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> transformers <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> AutoTokenizer, AutoModelForCausalLM


model_name_or_path = <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;/root/model/Shanghai_AI_Laboratory/internlm-chat-7b&quot;</span>

tokenizer = AutoTokenizer.from_pretrained(model_name_or_path, trust_remote_code=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
model = AutoModelForCausalLM.from_pretrained(model_name_or_path, trust_remote_code=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>, torch_dtype=torch.bfloat16, device_map=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'auto'</span>)
model = model.eval()

system_prompt = <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&quot;&quot;You are an AI assistant whose name is InternLM (书生·浦语).
- InternLM (书生·浦语) is a conversational language model that is developed by Shanghai AI Laboratory (上海人工智能实验室). It is designed to be helpful, honest, and harmless.
- InternLM (书生·浦语) can understand and communicate fluently in the language chosen by the user such as English and 中文.
&quot;&quot;&quot;</span>

messages = [(system_prompt, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">''</span>)]

print(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;=============Welcome to InternLM chatbot, type 'exit' to exit.=============&quot;</span>)

<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">while</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>:
    input_text = input(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;User  &gt;&gt;&gt; &quot;</span>)
    input_text = input_text.replace(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">' '</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">''</span>)
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> input_text == <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;exit&quot;</span>:
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">break</span>
    response, history = model.chat(tokenizer, input_text, history=messages)
    messages.append((input_text, response))
    print(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">f&quot;robot &gt;&gt;&gt; <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">{response}</span>&quot;</span>)
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">然后在终端运行以下命令，即可体验 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">InternLM-Chat-7B</code> 模型的对话能力。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">python /root/code/InternLM/cli_demo.py
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">web对话</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">先运行 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">/root/code/InternLM</code> 目录下的 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">web_demo.py</code> 文件，输入以下命令</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">bash
conda activate internlm-demo  
cd /root/code/InternLM
streamlit run web_demo.py --server.address 127.0.0.1 --server.port 6006
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">如果在云环境运行，想要在本地查看，需要使用ssh将云环境的6006端口映射到本地。方法：<br/>
1、本地ssh公钥上传云环境。复制本地公钥内容,回到 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">InternStudio</code> 控制台，点击配置 SSH Key。将刚刚复制的公钥添加进入即可。<br/>
2、点击<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">InternStudio</code> 的ssh连接，查看ssh连接命令的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">-p</code>参数后的端口号，例如是<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">33090</code></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">3、运行</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">ssh -CNg -L 6006:127.0.0.1:6006 root@ssh.intern-ai.org.cn -p 33090
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">最后，要在浏览器打开 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">http://127.0.0.1:6006</code> 页面后，模型才会加载，如下图所示：</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">Lagent的Demo</h2>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">环境准备</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">同上</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">模型下载</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">/root/model</code> 路径下新建 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">download.py</code> 文件并在其中输入以下内容，并运行 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">python /root/model/download.py</code> 执行下载，模型大小为 14 GB，下载模型大概需要 10~20 分钟</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> torch
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> modelscope <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> snapshot_download, AutoModel, AutoTokenizer
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> os
model_dir = snapshot_download(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'Shanghai_AI_Laboratory/internlm-chat-7b'</span>, cache_dir=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'/root/model'</span>, revision=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'v1.0.3'</span>)
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">代码下载</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">克隆 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">lagent</code> 仓库，并通过 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">pip install -e .</code> 源码安装 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Lagent</code></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">cd /root/code
git clone https://gitee.com/internlm/lagent.git
cd /root/code/lagent
pip install -e . # 源码安装
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">修改代码</strong><br/>
为演示web上demo，<br/>
将 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">/root/code/lagent/examples/react_web_demo.py</code> 内容替换为以下代码</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> copy
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> os
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> streamlit <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">as</span> st
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> streamlit.logger <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> get_logger
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> lagent.actions <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> ActionExecutor, GoogleSearch, PythonInterpreter
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> lagent.agents.react <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> ReAct
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> lagent.llms <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> GPTAPI
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> lagent.llms.huggingface <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> HFTransformerCasualLM
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">SessionState</span>:</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">init_state</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self)</span>:</span>
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&quot;&quot;Initialize session state variables.&quot;&quot;&quot;</span>
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'assistant'</span>] = []
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'user'</span>] = []
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">#action_list = [PythonInterpreter(), GoogleSearch()]</span>
        action_list = [PythonInterpreter()]
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'plugin_map'</span>] = {
            action.name: action
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span> action <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> action_list
        }
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_map'</span>] = {}
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_selected'</span>] = <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'plugin_actions'</span>] = set()
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">clear_state</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self)</span>:</span>
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&quot;&quot;Clear the existing session state.&quot;&quot;&quot;</span>
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'assistant'</span>] = []
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'user'</span>] = []
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_selected'</span>] = <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> st.session_state:
            st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span>]._session_history = []
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">StreamlitUI</span>:</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">__init__</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, session_state: SessionState)</span>:</span>
        self.init_streamlit()
        self.session_state = session_state
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">init_streamlit</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self)</span>:</span>
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&quot;&quot;Initialize Streamlit's UI settings.&quot;&quot;&quot;</span>
        st.set_page_config(
            layout=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'wide'</span>,
            page_title=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'lagent-web'</span>,
            page_icon=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'./docs/imgs/lagent_icon.png'</span>)
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># st.header(':robot_face: :blue[Lagent] Web Demo ', divider='rainbow')</span>
        st.sidebar.title(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'模型控制'</span>)
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">setup_sidebar</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self)</span>:</span>
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&quot;&quot;Setup the sidebar for model and plugin selection.&quot;&quot;&quot;</span>
        model_name = st.sidebar.selectbox(
            <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'模型选择：'</span>, options=[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'gpt-3.5-turbo'</span>,<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'internlm'</span>])
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> model_name != st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_selected'</span>]:
            model = self.init_model(model_name)
            self.session_state.clear_state()
            st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_selected'</span>] = model_name
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> st.session_state:
                <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">del</span> st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span>]
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span>:
            model = st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_map'</span>][model_name]
        plugin_name = st.sidebar.multiselect(
            <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'插件选择'</span>,
            options=list(st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'plugin_map'</span>].keys()),
            default=[list(st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'plugin_map'</span>].keys())[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>]],
        )
        plugin_action = [
            st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'plugin_map'</span>][name] <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span> name <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> plugin_name
        ]
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> st.session_state:
            st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span>]._action_executor = ActionExecutor(
                actions=plugin_action)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> st.sidebar.button(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'清空对话'</span>, key=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'clear'</span>):
            self.session_state.clear_state()
        uploaded_file = st.sidebar.file_uploader(
            <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'上传文件'</span>, type=[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'png'</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'jpg'</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'jpeg'</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'mp4'</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'mp3'</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'wav'</span>])
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> model_name, model, plugin_action, uploaded_file
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">init_model</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, option)</span>:</span>
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&quot;&quot;Initialize the model based on the selected option.&quot;&quot;&quot;</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> option <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">not</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_map'</span>]:
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> option.startswith(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'gpt'</span>):
                st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_map'</span>][option] = GPTAPI(
                    model_type=option)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span>:
                st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_map'</span>][option] = HFTransformerCasualLM(
                    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'/root/model/Shanghai_AI_Laboratory/internlm-chat-7b'</span>)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'model_map'</span>][option]
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">initialize_chatbot</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, model, plugin_action)</span>:</span>
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&quot;&quot;Initialize the chatbot with the given model and plugin actions.&quot;&quot;&quot;</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> ReAct(
            llm=model, action_executor=ActionExecutor(actions=plugin_action))
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">render_user</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, prompt: str)</span>:</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">with</span> st.chat_message(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'user'</span>):
            st.markdown(prompt)
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">render_assistant</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, agent_return)</span>:</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">with</span> st.chat_message(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'assistant'</span>):
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span> action <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> agent_return.actions:
                <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (action):
                    self.render_action(action)
            st.markdown(agent_return.response)
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">render_action</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, action)</span>:</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">with</span> st.expander(action.type, expanded=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>):
            st.markdown(
                <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&lt;p style='text-align: left;display:flex;'&gt; &lt;span style='font-size:14px;font-weight:600;text-align-last: justify;'&gt;插    件&lt;/span&gt;&lt;span style='text-align:left;display:block;'&gt;:&lt;/span&gt;&lt;span style='flex:1;'&gt;&quot;</span>  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># noqa E501</span>
                + action.type + <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'&lt;/span&gt;&lt;/p&gt;'</span>,
                unsafe_allow_html=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
            st.markdown(
                <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&lt;p style='text-align: left;display:flex;'&gt; &lt;span style='font-size:14px;font-weight:600;text-align-last: justify;'&gt;思考步骤&lt;/span&gt;&lt;span style='text-align:left;display:block;'&gt;:&lt;/span&gt;&lt;span style='flex:1;'&gt;&quot;</span>  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># noqa E501</span>
                + action.thought + <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'&lt;/span&gt;&lt;/p&gt;'</span>,
                unsafe_allow_html=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (isinstance(action.args, dict) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">and</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'text'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> action.args):
                st.markdown(
                    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&lt;p style='text-align: left;display:flex;'&gt;&lt;span style='font-size:14px;font-weight:600;text-align-last: justify;'&gt; 执行内容&lt;/span&gt;&lt;span style='text-align:left;display:block;'&gt;:&lt;/span&gt;&lt;/p&gt;&quot;</span>,  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># noqa E501</span>
                    unsafe_allow_html=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
                st.markdown(action.args[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'text'</span>])
            self.render_action_results(action)
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">render_action_results</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, action)</span>:</span>
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&quot;&quot;Render the results of action, including text, images, videos, and
        audios.&quot;&quot;&quot;</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (isinstance(action.result, dict)):
            st.markdown(
                <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&lt;p style='text-align: left;display:flex;'&gt;&lt;span style='font-size:14px;font-weight:600;text-align-last: justify;'&gt; 执行结果&lt;/span&gt;&lt;span style='text-align:left;display:block;'&gt;:&lt;/span&gt;&lt;/p&gt;&quot;</span>,  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># noqa E501</span>
                unsafe_allow_html=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'text'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> action.result:
                st.markdown(
                    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&lt;p style='text-align: left;'&gt;&quot;</span> + action.result[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'text'</span>] +
                    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'&lt;/p&gt;'</span>,
                    unsafe_allow_html=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'image'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> action.result:
                image_path = action.result[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'image'</span>]
                image_data = open(image_path, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'rb'</span>).read()
                st.image(image_data, caption=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'Generated Image'</span>)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'video'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> action.result:
                video_data = action.result[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'video'</span>]
                video_data = open(video_data, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'rb'</span>).read()
                st.video(video_data)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'audio'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> action.result:
                audio_data = action.result[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'audio'</span>]
                audio_data = open(audio_data, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'rb'</span>).read()
                st.audio(audio_data)
<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">main</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span>:</span>
    logger = get_logger(__name__)
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># Initialize Streamlit UI and setup sidebar</span>
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'ui'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">not</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> st.session_state:
        session_state = SessionState()
        session_state.init_state()
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'ui'</span>] = StreamlitUI(session_state)
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span>:
        st.set_page_config(
            layout=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'wide'</span>,
            page_title=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'lagent-web'</span>,
            page_icon=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'./docs/imgs/lagent_icon.png'</span>)
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># st.header(':robot_face: :blue[Lagent] Web Demo ', divider='rainbow')</span>
    model_name, model, plugin_action, uploaded_file = st.session_state[
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'ui'</span>].setup_sidebar()
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># Initialize chatbot if it is not already initialized</span>
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># or if the model has changed</span>
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">not</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> st.session_state <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">or</span> model != st.session_state[
            <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span>]._llm:
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span>] = st.session_state[
            <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'ui'</span>].initialize_chatbot(model, plugin_action)
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span> prompt, agent_return <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> zip(st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'user'</span>],
                                    st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'assistant'</span>]):
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'ui'</span>].render_user(prompt)
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'ui'</span>].render_assistant(agent_return)
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># User input form at the bottom (this part will be at the bottom)</span>
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># with st.form(key='my_form', clear_on_submit=True):</span>
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> user_input := st.chat_input(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">''</span>):
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'ui'</span>].render_user(user_input)
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'user'</span>].append(user_input)
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># Add file uploader to sidebar</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> uploaded_file:
            file_bytes = uploaded_file.read()
            file_type = uploaded_file.type
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'image'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> file_type:
                st.image(file_bytes, caption=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'Uploaded Image'</span>)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">elif</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'video'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> file_type:
                st.video(file_bytes, caption=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'Uploaded Video'</span>)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">elif</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'audio'</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> file_type:
                st.audio(file_bytes, caption=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'Uploaded Audio'</span>)
            <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># Save the file to a temporary location and get the path</span>
            file_path = os.path.join(root_dir, uploaded_file.name)
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">with</span> open(file_path, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'wb'</span>) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">as</span> tmpfile:
                tmpfile.write(file_bytes)
            st.write(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">f'File saved at: <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">{file_path}</span>'</span>)
            user_input = <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'我上传了一个图像，路径为: {file_path}. {user_input}'</span>.format(
                file_path=file_path, user_input=user_input)
        agent_return = st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'chatbot'</span>].chat(user_input)
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'assistant'</span>].append(copy.deepcopy(agent_return))
        logger.info(agent_return.inner_steps)
        st.session_state[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'ui'</span>].render_assistant(agent_return)
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> __name__ == <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'__main__'</span>:
    root_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
    root_dir = os.path.join(root_dir, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'tmp_dir'</span>)
    os.makedirs(root_dir, exist_ok=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
    main()
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">demo</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">运行</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">streamlit run /root/code/lagent/examples/react_web_demo.py --server.address 127.0.0.1 --server.port 6006
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">其他步骤同对话demo的网页方法</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">我们在 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Web</code> 页面选择 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">InternLM</code> 模型，等待模型加载完毕后，输入数学问题 已知 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">2x+3=10</code>，求<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">x</code> ,此时 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">InternLM-Chat-7B</code> 模型理解题意生成解此题的 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Python</code> 代码，<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Lagent</code> 调度送入 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Python</code> 代码解释器求出该问题的解。</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">浦语·灵笔图文理解创作 Demo</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">注意，需要A100(1/4) * 2 机器</strong></p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">环境准备</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">进入 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">conda</code> 环境之后，使用以下命令从本地克隆一个已有的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">pytorch 2.0.1</code> 的环境</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">/root/share/install_conda_env_internlm_base.sh xcomposer-demo
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">然后使用以下命令激活环境</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">conda activate xcomposer-demo
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">接下来运行以下命令，安装 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">transformers</code>、<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">gradio</code> 等依赖包。请严格安装以下版本安装！</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">pip install transformers==4.33.1 timm==0.4.12 sentencepiece==0.1.99 gradio==3.44.4 markdown2==2.4.10 xlsxwriter==3.1.2 einops accelerate
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">模型下载</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">安装 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">modelscope</code></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">pip install modelscope==1.9.5
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">/root/model</code> 路径下新建 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">download.py</code> 文件并在其中输入以下内容，并运行 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">python /root/model/download.py</code> 执行下载</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> torch
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> modelscope <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> snapshot_download, AutoModel, AutoTokenizer
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> os
model_dir = snapshot_download(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'Shanghai_AI_Laboratory/internlm-xcomposer-7b'</span>, cache_dir=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'/root/model'</span>, revision=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'master'</span>)
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">代码下载</h3>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">cd /root/code
git clone https://gitee.com/internlm/InternLM-XComposer.git
cd /root/code/InternLM-XComposer
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">Demo运行</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在终端运行以下代码：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">cd /root/code/InternLM-XComposer
python examples/web_demo.py  \
    --folder /root/model/Shanghai_AI_Laboratory/internlm-xcomposer-7b \
    --num_gpus 1 \
    --port 6006
</code></pre>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">作业</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">基础作业：</strong></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">使用 InternLM-Chat-7B 模型生成 300 字的小故事（需截图）。</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="【3浦语实战营】demo_files/Image.png" type="image/png" data-filename="Image.png"/><br/>
<img src="【3浦语实战营】demo_files/Image [1].png" type="image/png" data-filename="Image.png"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">熟悉 hugging face 下载功能，使用 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">huggingface_hub</code> python 包，下载 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">InternLM-20B</code> 的 config.json 文件到本地（需截图下载过程）。<br/>
<img src="【3浦语实战营】demo_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/>
<img src="【3浦语实战营】demo_files/Image [3].png" type="image/png" data-filename="Image.png"/><br/>
<img src="【3浦语实战营】demo_files/Image [4].png" type="image/png" data-filename="Image.png"/></li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">进阶作业（可选做）</strong></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;">完成浦语·灵笔的图文理解及创作部署<br/>
<img src="【3浦语实战营】demo_files/Image [5].png" type="image/png" data-filename="Image.png"/></p>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;">完成 Lagent 工具调用 Demo 创作部署<br/>
<img src="【3浦语实战营】demo_files/Image [6].png" type="image/png" data-filename="Image.png"/><br/>
<img src="【3浦语实战营】demo_files/Image [7].png" type="image/png" data-filename="Image.png"/></p>
</li>
</ul>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%5BTOC%5D%0A%23%23%20%E5%AF%B9%E8%AF%9DDemo%0A%23%23%23%20%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%0A%0A%E5%9C%A8%20%5BInternStudio%5D(https%3A%2F%2Fstudio.intern-ai.org.cn%2F)%20%E5%B9%B3%E5%8F%B0%E4%B8%AD%E9%80%89%E6%8B%A9%20A100(1%2F4)%20%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%E9%95%9C%E5%83%8F%E9%80%89%E6%8B%A9%20%60Cuda11.7-conda%60%0A%0A%E8%BF%9B%E5%85%A5%20%60conda%60%20%E7%8E%AF%E5%A2%83%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%E4%BB%8E%E6%9C%AC%E5%9C%B0%E5%85%8B%E9%9A%86%E4%B8%80%E4%B8%AA%E5%B7%B2%E6%9C%89%E7%9A%84%20%60pytorch%202.0.1%60%20%E7%9A%84%E7%8E%AF%E5%A2%83%0A%0A%60%60%60%20shell%0A-%20bash%0A-%20bash%20%2Froot%2Fshare%2Finstall_conda_env_internlm_base.sh%20internlm-demo%20%0A-%20conda%20activate%20internlm-demo%0A%0A%60%60%60%0A%0A%E5%B9%B6%E5%9C%A8%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%AE%89%E8%A3%85%E8%BF%90%E8%A1%8C%20demo%20%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E4%BE%9D%E8%B5%96%E3%80%82%0A%0A%60%60%60shell%0Apython%20-m%20pip%20install%20--upgrade%20pip%0Apip%20install%20modelscope%3D%3D1.9.5%0Apip%20install%20transformers%3D%3D4.35.2%0Apip%20install%20streamlit%3D%3D1.24.0%0Apip%20install%20sentencepiece%3D%3D0.1.99%0Apip%20install%20accelerate%3D%3D0.24.1%0A%60%60%60%0A%23%23%23%20%E6%A8%A1%E5%9E%8B%E4%B8%8B%E8%BD%BD%0A%0A%E6%96%B0%E5%BB%BA%20%60download.py%60%20%E6%96%87%E4%BB%B6%E5%B9%B6%E5%9C%A8%E5%85%B6%E4%B8%AD%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%86%85%E5%AE%B9%EF%BC%8C%E7%B2%98%E8%B4%B4%E4%BB%A3%E7%A0%81%E5%90%8E%E8%AE%B0%E5%BE%97%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%E3%80%82%E5%B9%B6%E8%BF%90%E8%A1%8C%20%60python%20%2Froot%2Fmodel%2Fdownload.py%60%20%E6%89%A7%E8%A1%8C%E4%B8%8B%E8%BD%BD%EF%BC%8C%E6%A8%A1%E5%9E%8B%E5%A4%A7%E5%B0%8F%E4%B8%BA%2014%20GB%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%A4%A7%E6%A6%82%E9%9C%80%E8%A6%81%2010~20%20%E5%88%86%E9%92%9F%0A%0A%60%60%60python%0Aimport%20torch%0Afrom%20modelscope%20import%20snapshot_download%2C%20AutoModel%2C%20AutoTokenizer%0Aimport%20os%0Amodel_dir%20%3D%20snapshot_download('Shanghai_AI_Laboratory%2Finternlm-chat-7b'%2C%20cache_dir%3D'%2Froot%2Fmodel'%2C%20revision%3D'v1.0.3')%0A%60%60%60%0A%0A%23%23%23%20%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD%0A%0A%0A%60%60%60shell%0Acd%20%2Froot%2Fcode%0Agit%20clone%20https%3A%2F%2Fgitee.com%2Finternlm%2FInternLM.git%0Acd%20InternLM%0A%60%60%60%0A**%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%94%B9**%0A%0A%E5%B0%86%20%60%2Froot%2Fcode%2FInternLM%2Fweb_demo.py%60%20%E4%B8%AD%2029%20%E8%A1%8C%E5%92%8C%2033%20%E8%A1%8C%E7%9A%84%E6%A8%A1%E5%9E%8B%E6%9B%B4%E6%8D%A2%E4%B8%BA%E6%9C%AC%E5%9C%B0%E7%9A%84%20%60%2Froot%2Fmodel%2FShanghai_AI_Laboratory%2Finternlm-chat-7b%60%E3%80%82%0A%0A%23%23%23%20%E7%BB%88%E7%AB%AF%E5%AF%B9%E8%AF%9D%0A%0A%E5%9C%A8%20%60%2Froot%2Fcode%2FInternLM%60%20%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%20%60cli_demo.py%60%20%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B0%86%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%E5%A1%AB%E5%85%A5%E5%85%B6%E4%B8%AD%EF%BC%9A%0A%0A%60%60%60python%0Aimport%20torch%0Afrom%20transformers%20import%20AutoTokenizer%2C%20AutoModelForCausalLM%0A%0A%0Amodel_name_or_path%20%3D%20%22%2Froot%2Fmodel%2FShanghai_AI_Laboratory%2Finternlm-chat-7b%22%0A%0Atokenizer%20%3D%20AutoTokenizer.from_pretrained(model_name_or_path%2C%20trust_remote_code%3DTrue)%0Amodel%20%3D%20AutoModelForCausalLM.from_pretrained(model_name_or_path%2C%20trust_remote_code%3DTrue%2C%20torch_dtype%3Dtorch.bfloat16%2C%20device_map%3D'auto')%0Amodel%20%3D%20model.eval()%0A%0Asystem_prompt%20%3D%20%22%22%22You%20are%20an%20AI%20assistant%20whose%20name%20is%20InternLM%20(%E4%B9%A6%E7%94%9F%C2%B7%E6%B5%A6%E8%AF%AD).%0A-%20InternLM%20(%E4%B9%A6%E7%94%9F%C2%B7%E6%B5%A6%E8%AF%AD)%20is%20a%20conversational%20language%20model%20that%20is%20developed%20by%20Shanghai%20AI%20Laboratory%20(%E4%B8%8A%E6%B5%B7%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%AE%9E%E9%AA%8C%E5%AE%A4).%20It%20is%20designed%20to%20be%20helpful%2C%20honest%2C%20and%20harmless.%0A-%20InternLM%20(%E4%B9%A6%E7%94%9F%C2%B7%E6%B5%A6%E8%AF%AD)%20can%20understand%20and%20communicate%20fluently%20in%20the%20language%20chosen%20by%20the%20user%20such%20as%20English%20and%20%E4%B8%AD%E6%96%87.%0A%22%22%22%0A%0Amessages%20%3D%20%5B(system_prompt%2C%20'')%5D%0A%0Aprint(%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3DWelcome%20to%20InternLM%20chatbot%2C%20type%20'exit'%20to%20exit.%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%22)%0A%0Awhile%20True%3A%0A%20%20%20%20input_text%20%3D%20input(%22User%20%20%3E%3E%3E%20%22)%0A%20%20%20%20input_text%20%3D%20input_text.replace('%20'%2C%20'')%0A%20%20%20%20if%20input_text%20%3D%3D%20%22exit%22%3A%0A%20%20%20%20%20%20%20%20break%0A%20%20%20%20response%2C%20history%20%3D%20model.chat(tokenizer%2C%20input_text%2C%20history%3Dmessages)%0A%20%20%20%20messages.append((input_text%2C%20response))%0A%20%20%20%20print(f%22robot%20%3E%3E%3E%20%7Bresponse%7D%22)%0A%60%60%60%0A%0A%E7%84%B6%E5%90%8E%E5%9C%A8%E7%BB%88%E7%AB%AF%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%8D%B3%E5%8F%AF%E4%BD%93%E9%AA%8C%20%60InternLM-Chat-7B%60%20%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AF%B9%E8%AF%9D%E8%83%BD%E5%8A%9B%E3%80%82%0A%0A%60%60%60shell%0Apython%20%2Froot%2Fcode%2FInternLM%2Fcli_demo.py%0A%60%60%60%0A%0A%23%23%23%20web%E5%AF%B9%E8%AF%9D%0A%0A%0A%E5%85%88%E8%BF%90%E8%A1%8C%20%60%2Froot%2Fcode%2FInternLM%60%20%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%20%60web_demo.py%60%20%E6%96%87%E4%BB%B6%EF%BC%8C%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%0A%0A%0A%60%60%60shell%0Abash%0Aconda%20activate%20internlm-demo%20%C2%A0%0Acd%20%2Froot%2Fcode%2FInternLM%0Astreamlit%20run%20web_demo.py%20--server.address%20127.0.0.1%20--server.port%206006%0A%60%60%60%0A%E5%A6%82%E6%9E%9C%E5%9C%A8%E4%BA%91%E7%8E%AF%E5%A2%83%E8%BF%90%E8%A1%8C%EF%BC%8C%E6%83%B3%E8%A6%81%E5%9C%A8%E6%9C%AC%E5%9C%B0%E6%9F%A5%E7%9C%8B%EF%BC%8C%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8ssh%E5%B0%86%E4%BA%91%E7%8E%AF%E5%A2%83%E7%9A%846006%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%88%B0%E6%9C%AC%E5%9C%B0%E3%80%82%E6%96%B9%E6%B3%95%EF%BC%9A%0A1%E3%80%81%E6%9C%AC%E5%9C%B0ssh%E5%85%AC%E9%92%A5%E4%B8%8A%E4%BC%A0%E4%BA%91%E7%8E%AF%E5%A2%83%E3%80%82%E5%A4%8D%E5%88%B6%E6%9C%AC%E5%9C%B0%E5%85%AC%E9%92%A5%E5%86%85%E5%AE%B9%2C%E5%9B%9E%E5%88%B0%20%60InternStudio%60%20%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%8C%E7%82%B9%E5%87%BB%E9%85%8D%E7%BD%AE%20SSH%20Key%E3%80%82%E5%B0%86%E5%88%9A%E5%88%9A%E5%A4%8D%E5%88%B6%E7%9A%84%E5%85%AC%E9%92%A5%E6%B7%BB%E5%8A%A0%E8%BF%9B%E5%85%A5%E5%8D%B3%E5%8F%AF%E3%80%82%0A2%E3%80%81%E7%82%B9%E5%87%BB%60InternStudio%60%20%E7%9A%84ssh%E8%BF%9E%E6%8E%A5%EF%BC%8C%E6%9F%A5%E7%9C%8Bssh%E8%BF%9E%E6%8E%A5%E5%91%BD%E4%BB%A4%E7%9A%84%60-p%60%E5%8F%82%E6%95%B0%E5%90%8E%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7%EF%BC%8C%E4%BE%8B%E5%A6%82%E6%98%AF%6033090%60%0A%0A3%E3%80%81%E8%BF%90%E8%A1%8C%0A%60%60%60shell%0Assh%20-CNg%20-L%206006%3A127.0.0.1%3A6006%20root%40ssh.intern-ai.org.cn%20-p%2033090%0A%60%60%60%0A%0A%E6%9C%80%E5%90%8E%EF%BC%8C%E8%A6%81%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%20%60http%3A%2F%2F127.0.0.1%3A6006%60%20%E9%A1%B5%E9%9D%A2%E5%90%8E%EF%BC%8C%E6%A8%A1%E5%9E%8B%E6%89%8D%E4%BC%9A%E5%8A%A0%E8%BD%BD%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A%0A%0A%23%23%20Lagent%E7%9A%84Demo%0A%23%23%23%20%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%0A%E5%90%8C%E4%B8%8A%0A%23%23%23%20%E6%A8%A1%E5%9E%8B%E4%B8%8B%E8%BD%BD%0A%0A%0A%E5%9C%A8%20%60%2Froot%2Fmodel%60%20%E8%B7%AF%E5%BE%84%E4%B8%8B%E6%96%B0%E5%BB%BA%20%60download.py%60%20%E6%96%87%E4%BB%B6%E5%B9%B6%E5%9C%A8%E5%85%B6%E4%B8%AD%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%86%85%E5%AE%B9%EF%BC%8C%E5%B9%B6%E8%BF%90%E8%A1%8C%20%60python%20%2Froot%2Fmodel%2Fdownload.py%60%20%E6%89%A7%E8%A1%8C%E4%B8%8B%E8%BD%BD%EF%BC%8C%E6%A8%A1%E5%9E%8B%E5%A4%A7%E5%B0%8F%E4%B8%BA%2014%20GB%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%A4%A7%E6%A6%82%E9%9C%80%E8%A6%81%2010~20%20%E5%88%86%E9%92%9F%0A%60%60%60python%0Aimport%20torch%0Afrom%20modelscope%20import%20snapshot_download%2C%20AutoModel%2C%20AutoTokenizer%0Aimport%20os%0Amodel_dir%20%3D%20snapshot_download('Shanghai_AI_Laboratory%2Finternlm-chat-7b'%2C%20cache_dir%3D'%2Froot%2Fmodel'%2C%20revision%3D'v1.0.3')%0A%60%60%60%0A%0A%23%23%23%20%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD%0A%0A%E5%85%8B%E9%9A%86%20%60lagent%60%20%E4%BB%93%E5%BA%93%EF%BC%8C%E5%B9%B6%E9%80%9A%E8%BF%87%20%60pip%20install%20-e%20.%60%20%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85%20%60Lagent%60%0A%60%60%60shell%0Acd%20%2Froot%2Fcode%0Agit%20clone%20https%3A%2F%2Fgitee.com%2Finternlm%2Flagent.git%0Acd%20%2Froot%2Fcode%2Flagent%0Apip%20install%20-e%20.%20%23%20%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85%0A%60%60%60%0A**%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81**%0A%E4%B8%BA%E6%BC%94%E7%A4%BAweb%E4%B8%8Ademo%EF%BC%8C%0A%E5%B0%86%20%60%2Froot%2Fcode%2Flagent%2Fexamples%2Freact_web_demo.py%60%20%E5%86%85%E5%AE%B9%E6%9B%BF%E6%8D%A2%E4%B8%BA%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%0A%0A%60%60%60python%0Aimport%20copy%0Aimport%20os%0Aimport%20streamlit%20as%20st%0Afrom%20streamlit.logger%20import%20get_logger%0Afrom%20lagent.actions%20import%20ActionExecutor%2C%20GoogleSearch%2C%20PythonInterpreter%0Afrom%20lagent.agents.react%20import%20ReAct%0Afrom%20lagent.llms%20import%20GPTAPI%0Afrom%20lagent.llms.huggingface%20import%20HFTransformerCasualLM%0Aclass%20SessionState%3A%0A%C2%A0%20%C2%A0%20def%20init_state(self)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%22%22Initialize%20session%20state%20variables.%22%22%22%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'assistant'%5D%20%3D%20%5B%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'user'%5D%20%3D%20%5B%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%23action_list%20%3D%20%5BPythonInterpreter()%2C%20GoogleSearch()%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20action_list%20%3D%20%5BPythonInterpreter()%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'plugin_map'%5D%20%3D%20%7B%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20action.name%3A%20action%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20for%20action%20in%20action_list%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%7D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'model_map'%5D%20%3D%20%7B%7D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'model_selected'%5D%20%3D%20None%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'plugin_actions'%5D%20%3D%20set()%0A%C2%A0%20%C2%A0%20def%20clear_state(self)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%22%22Clear%20the%20existing%20session%20state.%22%22%22%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'assistant'%5D%20%3D%20%5B%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'user'%5D%20%3D%20%5B%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'model_selected'%5D%20%3D%20None%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20'chatbot'%20in%20st.session_state%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'chatbot'%5D._session_history%20%3D%20%5B%5D%0Aclass%20StreamlitUI%3A%0A%C2%A0%20%C2%A0%20def%20__init__(self%2C%20session_state%3A%20SessionState)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20self.init_streamlit()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20self.session_state%20%3D%20session_state%0A%C2%A0%20%C2%A0%20def%20init_streamlit(self)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%22%22Initialize%20Streamlit's%20UI%20settings.%22%22%22%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.set_page_config(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20layout%3D'wide'%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20page_title%3D'lagent-web'%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20page_icon%3D'.%2Fdocs%2Fimgs%2Flagent_icon.png')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%23%20st.header('%3Arobot_face%3A%20%3Ablue%5BLagent%5D%20Web%20Demo%20'%2C%20divider%3D'rainbow')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.sidebar.title('%E6%A8%A1%E5%9E%8B%E6%8E%A7%E5%88%B6')%0A%C2%A0%20%C2%A0%20def%20setup_sidebar(self)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%22%22Setup%20the%20sidebar%20for%20model%20and%20plugin%20selection.%22%22%22%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20model_name%20%3D%20st.sidebar.selectbox(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20'%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9%EF%BC%9A'%2C%20options%3D%5B'gpt-3.5-turbo'%2C'internlm'%5D)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20model_name%20!%3D%20st.session_state%5B'model_selected'%5D%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20model%20%3D%20self.init_model(model_name)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20self.session_state.clear_state()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'model_selected'%5D%20%3D%20model_name%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20'chatbot'%20in%20st.session_state%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20del%20st.session_state%5B'chatbot'%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20else%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20model%20%3D%20st.session_state%5B'model_map'%5D%5Bmodel_name%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20plugin_name%20%3D%20st.sidebar.multiselect(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20'%E6%8F%92%E4%BB%B6%E9%80%89%E6%8B%A9'%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20options%3Dlist(st.session_state%5B'plugin_map'%5D.keys())%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20default%3D%5Blist(st.session_state%5B'plugin_map'%5D.keys())%5B0%5D%5D%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20plugin_action%20%3D%20%5B%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'plugin_map'%5D%5Bname%5D%20for%20name%20in%20plugin_name%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20'chatbot'%20in%20st.session_state%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'chatbot'%5D._action_executor%20%3D%20ActionExecutor(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20actions%3Dplugin_action)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20st.sidebar.button('%E6%B8%85%E7%A9%BA%E5%AF%B9%E8%AF%9D'%2C%20key%3D'clear')%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20self.session_state.clear_state()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20uploaded_file%20%3D%20st.sidebar.file_uploader(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20'%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6'%2C%20type%3D%5B'png'%2C%20'jpg'%2C%20'jpeg'%2C%20'mp4'%2C%20'mp3'%2C%20'wav'%5D)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20return%20model_name%2C%20model%2C%20plugin_action%2C%20uploaded_file%0A%C2%A0%20%C2%A0%20def%20init_model(self%2C%20option)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%22%22Initialize%20the%20model%20based%20on%20the%20selected%20option.%22%22%22%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20option%20not%20in%20st.session_state%5B'model_map'%5D%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20option.startswith('gpt')%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'model_map'%5D%5Boption%5D%20%3D%20GPTAPI(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20model_type%3Doption)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20else%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'model_map'%5D%5Boption%5D%20%3D%20HFTransformerCasualLM(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20'%2Froot%2Fmodel%2FShanghai_AI_Laboratory%2Finternlm-chat-7b')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20return%20st.session_state%5B'model_map'%5D%5Boption%5D%0A%C2%A0%20%C2%A0%20def%20initialize_chatbot(self%2C%20model%2C%20plugin_action)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%22%22Initialize%20the%20chatbot%20with%20the%20given%20model%20and%20plugin%20actions.%22%22%22%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20return%20ReAct(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20llm%3Dmodel%2C%20action_executor%3DActionExecutor(actions%3Dplugin_action))%0A%C2%A0%20%C2%A0%20def%20render_user(self%2C%20prompt%3A%20str)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20with%20st.chat_message('user')%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.markdown(prompt)%0A%C2%A0%20%C2%A0%20def%20render_assistant(self%2C%20agent_return)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20with%20st.chat_message('assistant')%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20for%20action%20in%20agent_return.actions%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20(action)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20self.render_action(action)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.markdown(agent_return.response)%0A%C2%A0%20%C2%A0%20def%20render_action(self%2C%20action)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20with%20st.expander(action.type%2C%20expanded%3DTrue)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.markdown(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%3Cp%20style%3D'text-align%3A%20left%3Bdisplay%3Aflex%3B'%3E%20%3Cspan%20style%3D'font-size%3A14px%3Bfont-weight%3A600%3Bwidth%3A70px%3Btext-align-last%3A%20justify%3B'%3E%E6%8F%92%20%C2%A0%20%C2%A0%E4%BB%B6%3C%2Fspan%3E%3Cspan%20style%3D'width%3A14px%3Btext-align%3Aleft%3Bdisplay%3Ablock%3B'%3E%3A%3C%2Fspan%3E%3Cspan%20style%3D'flex%3A1%3B'%3E%22%20%C2%A0%23%20noqa%20E501%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%2B%20action.type%20%2B%20'%3C%2Fspan%3E%3C%2Fp%3E'%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20unsafe_allow_html%3DTrue)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.markdown(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%3Cp%20style%3D'text-align%3A%20left%3Bdisplay%3Aflex%3B'%3E%20%3Cspan%20style%3D'font-size%3A14px%3Bfont-weight%3A600%3Bwidth%3A70px%3Btext-align-last%3A%20justify%3B'%3E%E6%80%9D%E8%80%83%E6%AD%A5%E9%AA%A4%3C%2Fspan%3E%3Cspan%20style%3D'width%3A14px%3Btext-align%3Aleft%3Bdisplay%3Ablock%3B'%3E%3A%3C%2Fspan%3E%3Cspan%20style%3D'flex%3A1%3B'%3E%22%20%C2%A0%23%20noqa%20E501%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%2B%20action.thought%20%2B%20'%3C%2Fspan%3E%3C%2Fp%3E'%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20unsafe_allow_html%3DTrue)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20(isinstance(action.args%2C%20dict)%20and%20'text'%20in%20action.args)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.markdown(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%3Cp%20style%3D'text-align%3A%20left%3Bdisplay%3Aflex%3B'%3E%3Cspan%20style%3D'font-size%3A14px%3Bfont-weight%3A600%3Bwidth%3A70px%3Btext-align-last%3A%20justify%3B'%3E%20%E6%89%A7%E8%A1%8C%E5%86%85%E5%AE%B9%3C%2Fspan%3E%3Cspan%20style%3D'width%3A14px%3Btext-align%3Aleft%3Bdisplay%3Ablock%3B'%3E%3A%3C%2Fspan%3E%3C%2Fp%3E%22%2C%20%C2%A0%23%20noqa%20E501%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20unsafe_allow_html%3DTrue)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.markdown(action.args%5B'text'%5D)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20self.render_action_results(action)%0A%C2%A0%20%C2%A0%20def%20render_action_results(self%2C%20action)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%22%22Render%20the%20results%20of%20action%2C%20including%20text%2C%20images%2C%20videos%2C%20and%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20audios.%22%22%22%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20(isinstance(action.result%2C%20dict))%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.markdown(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%3Cp%20style%3D'text-align%3A%20left%3Bdisplay%3Aflex%3B'%3E%3Cspan%20style%3D'font-size%3A14px%3Bfont-weight%3A600%3Bwidth%3A70px%3Btext-align-last%3A%20justify%3B'%3E%20%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%3C%2Fspan%3E%3Cspan%20style%3D'width%3A14px%3Btext-align%3Aleft%3Bdisplay%3Ablock%3B'%3E%3A%3C%2Fspan%3E%3C%2Fp%3E%22%2C%20%C2%A0%23%20noqa%20E501%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20unsafe_allow_html%3DTrue)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20'text'%20in%20action.result%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.markdown(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%22%3Cp%20style%3D'text-align%3A%20left%3B'%3E%22%20%2B%20action.result%5B'text'%5D%20%2B%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20'%3C%2Fp%3E'%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20unsafe_allow_html%3DTrue)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20'image'%20in%20action.result%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20image_path%20%3D%20action.result%5B'image'%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20image_data%20%3D%20open(image_path%2C%20'rb').read()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.image(image_data%2C%20caption%3D'Generated%20Image')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20'video'%20in%20action.result%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20video_data%20%3D%20action.result%5B'video'%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20video_data%20%3D%20open(video_data%2C%20'rb').read()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.video(video_data)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20'audio'%20in%20action.result%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20audio_data%20%3D%20action.result%5B'audio'%5D%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20audio_data%20%3D%20open(audio_data%2C%20'rb').read()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.audio(audio_data)%0Adef%20main()%3A%0A%C2%A0%20%C2%A0%20logger%20%3D%20get_logger(__name__)%0A%C2%A0%20%C2%A0%20%23%20Initialize%20Streamlit%20UI%20and%20setup%20sidebar%0A%C2%A0%20%C2%A0%20if%20'ui'%20not%20in%20st.session_state%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20session_state%20%3D%20SessionState()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20session_state.init_state()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'ui'%5D%20%3D%20StreamlitUI(session_state)%0A%C2%A0%20%C2%A0%20else%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.set_page_config(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20layout%3D'wide'%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20page_title%3D'lagent-web'%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20page_icon%3D'.%2Fdocs%2Fimgs%2Flagent_icon.png')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%23%20st.header('%3Arobot_face%3A%20%3Ablue%5BLagent%5D%20Web%20Demo%20'%2C%20divider%3D'rainbow')%0A%C2%A0%20%C2%A0%20model_name%2C%20model%2C%20plugin_action%2C%20uploaded_file%20%3D%20st.session_state%5B%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20'ui'%5D.setup_sidebar()%0A%C2%A0%20%C2%A0%20%23%20Initialize%20chatbot%20if%20it%20is%20not%20already%20initialized%0A%C2%A0%20%C2%A0%20%23%20or%20if%20the%20model%20has%20changed%0A%C2%A0%20%C2%A0%20if%20'chatbot'%20not%20in%20st.session_state%20or%20model%20!%3D%20st.session_state%5B%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20'chatbot'%5D._llm%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'chatbot'%5D%20%3D%20st.session_state%5B%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20'ui'%5D.initialize_chatbot(model%2C%20plugin_action)%0A%C2%A0%20%C2%A0%20for%20prompt%2C%20agent_return%20in%20zip(st.session_state%5B'user'%5D%2C%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'assistant'%5D)%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'ui'%5D.render_user(prompt)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'ui'%5D.render_assistant(agent_return)%0A%C2%A0%20%C2%A0%20%23%20User%20input%20form%20at%20the%20bottom%20(this%20part%20will%20be%20at%20the%20bottom)%0A%C2%A0%20%C2%A0%20%23%20with%20st.form(key%3D'my_form'%2C%20clear_on_submit%3DTrue)%3A%0A%C2%A0%20%C2%A0%20if%20user_input%20%3A%3D%20st.chat_input('')%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'ui'%5D.render_user(user_input)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'user'%5D.append(user_input)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%23%20Add%20file%20uploader%20to%20sidebar%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20uploaded_file%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20file_bytes%20%3D%20uploaded_file.read()%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20file_type%20%3D%20uploaded_file.type%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20if%20'image'%20in%20file_type%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.image(file_bytes%2C%20caption%3D'Uploaded%20Image')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20elif%20'video'%20in%20file_type%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.video(file_bytes%2C%20caption%3D'Uploaded%20Video')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20elif%20'audio'%20in%20file_type%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.audio(file_bytes%2C%20caption%3D'Uploaded%20Audio')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%23%20Save%20the%20file%20to%20a%20temporary%20location%20and%20get%20the%20path%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20file_path%20%3D%20os.path.join(root_dir%2C%20uploaded_file.name)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20with%20open(file_path%2C%20'wb')%20as%20tmpfile%3A%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20tmpfile.write(file_bytes)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.write(f'File%20saved%20at%3A%20%7Bfile_path%7D')%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20user_input%20%3D%20'%E6%88%91%E4%B8%8A%E4%BC%A0%E4%BA%86%E4%B8%80%E4%B8%AA%E5%9B%BE%E5%83%8F%EF%BC%8C%E8%B7%AF%E5%BE%84%E4%B8%BA%3A%20%7Bfile_path%7D.%20%7Buser_input%7D'.format(%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20file_path%3Dfile_path%2C%20user_input%3Duser_input)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20agent_return%20%3D%20st.session_state%5B'chatbot'%5D.chat(user_input)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'assistant'%5D.append(copy.deepcopy(agent_return))%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20logger.info(agent_return.inner_steps)%0A%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20st.session_state%5B'ui'%5D.render_assistant(agent_return)%0Aif%20__name__%20%3D%3D%20'__main__'%3A%0A%C2%A0%20%C2%A0%20root_dir%20%3D%20os.path.dirname(os.path.dirname(os.path.abspath(__file__)))%0A%C2%A0%20%C2%A0%20root_dir%20%3D%20os.path.join(root_dir%2C%20'tmp_dir')%0A%C2%A0%20%C2%A0%20os.makedirs(root_dir%2C%20exist_ok%3DTrue)%0A%C2%A0%20%C2%A0%20main()%0A%60%60%60%0A%0A%23%23%23%20demo%0A%E8%BF%90%E8%A1%8C%0A%60%60%60shell%0Astreamlit%20run%20%2Froot%2Fcode%2Flagent%2Fexamples%2Freact_web_demo.py%20--server.address%20127.0.0.1%20--server.port%206006%0A%60%60%60%0A%E5%85%B6%E4%BB%96%E6%AD%A5%E9%AA%A4%E5%90%8C%E5%AF%B9%E8%AF%9Ddemo%E7%9A%84%E7%BD%91%E9%A1%B5%E6%96%B9%E6%B3%95%0A%0A%0A%E6%88%91%E4%BB%AC%E5%9C%A8%20%60Web%60%20%E9%A1%B5%E9%9D%A2%E9%80%89%E6%8B%A9%20%60InternLM%60%20%E6%A8%A1%E5%9E%8B%EF%BC%8C%E7%AD%89%E5%BE%85%E6%A8%A1%E5%9E%8B%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%AF%95%E5%90%8E%EF%BC%8C%E8%BE%93%E5%85%A5%E6%95%B0%E5%AD%A6%E9%97%AE%E9%A2%98%20%E5%B7%B2%E7%9F%A5%20%602x%2B3%3D10%60%EF%BC%8C%E6%B1%82%60x%60%20%2C%E6%AD%A4%E6%97%B6%20%60InternLM-Chat-7B%60%20%E6%A8%A1%E5%9E%8B%E7%90%86%E8%A7%A3%E9%A2%98%E6%84%8F%E7%94%9F%E6%88%90%E8%A7%A3%E6%AD%A4%E9%A2%98%E7%9A%84%20%60Python%60%20%E4%BB%A3%E7%A0%81%EF%BC%8C%60Lagent%60%20%E8%B0%83%E5%BA%A6%E9%80%81%E5%85%A5%20%60Python%60%20%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A%E5%99%A8%E6%B1%82%E5%87%BA%E8%AF%A5%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E3%80%82%0A%0A%23%23%20%E6%B5%A6%E8%AF%AD%C2%B7%E7%81%B5%E7%AC%94%E5%9B%BE%E6%96%87%E7%90%86%E8%A7%A3%E5%88%9B%E4%BD%9C%20Demo%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%8C%E9%9C%80%E8%A6%81A100(1%2F4)%20*%202%20%E6%9C%BA%E5%99%A8**%0A%23%23%23%20%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%0A%0A%E8%BF%9B%E5%85%A5%20%60conda%60%20%E7%8E%AF%E5%A2%83%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%E4%BB%8E%E6%9C%AC%E5%9C%B0%E5%85%8B%E9%9A%86%E4%B8%80%E4%B8%AA%E5%B7%B2%E6%9C%89%E7%9A%84%60pytorch%202.0.1%60%20%E7%9A%84%E7%8E%AF%E5%A2%83%0A%60%60%60shell%0A%2Froot%2Fshare%2Finstall_conda_env_internlm_base.sh%20xcomposer-demo%0A%60%60%60%0A%E7%84%B6%E5%90%8E%E4%BD%BF%E7%94%A8%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%E6%BF%80%E6%B4%BB%E7%8E%AF%E5%A2%83%0A%60%60%60shell%0Aconda%20activate%20xcomposer-demo%0A%60%60%60%0A%0A%E6%8E%A5%E4%B8%8B%E6%9D%A5%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%AE%89%E8%A3%85%20%60transformers%60%E3%80%81%60gradio%60%20%E7%AD%89%E4%BE%9D%E8%B5%96%E5%8C%85%E3%80%82%E8%AF%B7%E4%B8%A5%E6%A0%BC%E5%AE%89%E8%A3%85%E4%BB%A5%E4%B8%8B%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85%EF%BC%81%0A%60%60%60shell%0Apip%20install%20transformers%3D%3D4.33.1%20timm%3D%3D0.4.12%20sentencepiece%3D%3D0.1.99%20gradio%3D%3D3.44.4%20markdown2%3D%3D2.4.10%20xlsxwriter%3D%3D3.1.2%20einops%20accelerate%0A%60%60%60%0A%0A%23%23%23%20%E6%A8%A1%E5%9E%8B%E4%B8%8B%E8%BD%BD%0A%0A%0A%E5%AE%89%E8%A3%85%20%60modelscope%60%0A%60%60%60shell%0Apip%20install%20modelscope%3D%3D1.9.5%0A%60%60%60%0A%E5%9C%A8%20%60%2Froot%2Fmodel%60%20%E8%B7%AF%E5%BE%84%E4%B8%8B%E6%96%B0%E5%BB%BA%20%60download.py%60%20%E6%96%87%E4%BB%B6%E5%B9%B6%E5%9C%A8%E5%85%B6%E4%B8%AD%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%86%85%E5%AE%B9%EF%BC%8C%E5%B9%B6%E8%BF%90%E8%A1%8C%20%60python%20%2Froot%2Fmodel%2Fdownload.py%60%20%E6%89%A7%E8%A1%8C%E4%B8%8B%E8%BD%BD%0A%60%60%60python%0Aimport%20torch%0Afrom%20modelscope%20import%20snapshot_download%2C%20AutoModel%2C%20AutoTokenizer%0Aimport%20os%0Amodel_dir%20%3D%20snapshot_download('Shanghai_AI_Laboratory%2Finternlm-xcomposer-7b'%2C%20cache_dir%3D'%2Froot%2Fmodel'%2C%20revision%3D'master')%0A%60%60%60%0A%0A%23%23%23%20%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD%0A%0A%60%60%60shell%0Acd%20%2Froot%2Fcode%0Agit%20clone%20https%3A%2F%2Fgitee.com%2Finternlm%2FInternLM-XComposer.git%0Acd%20%2Froot%2Fcode%2FInternLM-XComposer%0A%60%60%60%0A%0A%0A%0A%23%23%23%20Demo%E8%BF%90%E8%A1%8C%0A%0A%E5%9C%A8%E7%BB%88%E7%AB%AF%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A%0A%60%60%60shell%0Acd%20%2Froot%2Fcode%2FInternLM-XComposer%0Apython%20examples%2Fweb_demo.py%20%C2%A0%5C%0A%C2%A0%20%C2%A0%20--folder%20%2Froot%2Fmodel%2FShanghai_AI_Laboratory%2Finternlm-xcomposer-7b%20%5C%0A%C2%A0%20%C2%A0%20--num_gpus%201%20%5C%0A%C2%A0%20%C2%A0%20--port%206006%0A%60%60%60%0A%0A%23%23%20%E4%BD%9C%E4%B8%9A%0A%0A**%E5%9F%BA%E7%A1%80%E4%BD%9C%E4%B8%9A%EF%BC%9A**%0A-%20%E4%BD%BF%E7%94%A8%20InternLM-Chat-7B%20%E6%A8%A1%E5%9E%8B%E7%94%9F%E6%88%90%20300%20%E5%AD%97%E7%9A%84%E5%B0%8F%E6%95%85%E4%BA%8B%EF%BC%88%E9%9C%80%E6%88%AA%E5%9B%BE%EF%BC%89%E3%80%82%0A%0A%0A!%5B8525bac27d900d8b684613124e34afe6.png%5D(en-resource%3A%2F%2Fdatabase%2F5198%3A1)%0A!%5B561dcfdde7fcefc9d237734db9668874.png%5D(en-resource%3A%2F%2Fdatabase%2F5200%3A1)%0A%0A-%20%E7%86%9F%E6%82%89%20hugging%20face%20%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD%EF%BC%8C%E4%BD%BF%E7%94%A8%20%60huggingface_hub%60%20python%20%E5%8C%85%EF%BC%8C%E4%B8%8B%E8%BD%BD%20%60InternLM-20B%60%20%E7%9A%84%20config.json%20%E6%96%87%E4%BB%B6%E5%88%B0%E6%9C%AC%E5%9C%B0%EF%BC%88%E9%9C%80%E6%88%AA%E5%9B%BE%E4%B8%8B%E8%BD%BD%E8%BF%87%E7%A8%8B%EF%BC%89%E3%80%82%0A!%5Bd59b757789cbeae8d2fa30bb505c913f.png%5D(en-resource%3A%2F%2Fdatabase%2F5208%3A1)%0A!%5B82ac4415c581e8fa669c167612ce5722.png%5D(en-resource%3A%2F%2Fdatabase%2F5210%3A1)%0A!%5B935b64c0d818a057d82f0f4680241567.png%5D(en-resource%3A%2F%2Fdatabase%2F5216%3A1)%0A%0A%0A**%E8%BF%9B%E9%98%B6%E4%BD%9C%E4%B8%9A%EF%BC%88%E5%8F%AF%E9%80%89%E5%81%9A%EF%BC%89**%0A-%20%E5%AE%8C%E6%88%90%E6%B5%A6%E8%AF%AD%C2%B7%E7%81%B5%E7%AC%94%E7%9A%84%E5%9B%BE%E6%96%87%E7%90%86%E8%A7%A3%E5%8F%8A%E5%88%9B%E4%BD%9C%E9%83%A8%E7%BD%B2%0A!%5B147e28b27b579fa2e4728a24dadcfe9b.png%5D(en-resource%3A%2F%2Fdatabase%2F5206%3A1)%0A%0A%0A-%20%E5%AE%8C%E6%88%90%20Lagent%20%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%20Demo%20%E5%88%9B%E4%BD%9C%E9%83%A8%E7%BD%B2%0A!%5Bc91dbd0abc3a02c98f6474ca2dc72977.png%5D(en-resource%3A%2F%2Fdatabase%2F5202%3A1)%0A!%5Bbeba29c4a6423b152c76334e61572fb3.png%5D(en-resource%3A%2F%2Fdatabase%2F5204%3A1)%0A%0A%0A%0A</center></span>
</div></body></html> 